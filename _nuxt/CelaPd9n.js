import{_ as G,c as v,o as p,v as u,x as X,r as Y,y as h,s as S,a as i,b as f,z as U,d as y,t as T,u as o,w as A,A as D,B as R,F as Z,C as ee,D as te,E as ne}from"#entry";import{_ as E,a as se}from"./CB6i6k_P.js";const le="_GameAvatar_1qr8j_9",oe={GameAvatar:le},re={};function ae(_,e){return p(),v("div",{class:u(_.$style.GameAvatar)},null,2)}const ie={$style:oe},ue=G(re,[["render",ae],["__cssModules",ie]]),k=X("gameStore",()=>{const _={initRows:7,initCols:9,moveDurationMs:200},e=Y({settingsRows:_.initRows,settingsCols:_.initCols,rows:_.initRows,cols:_.initCols,grid:[],player:{x:0,y:0,facing:"right",state:"idle",runTimer:null},moves:0,solution:[],showSolution:!1,winStreak:0}),r=h(()=>e.value.grid.flat());function n(t,s){const a=[];for(let c=0;c<t;c++){const d=[];for(let $=0;$<s;$++)d.push({x:$,y:c,required:1/0,remaining:1/0,visits:0});a.push(d)}e.value.grid=a}function l(){e.value.rows=e.value.settingsRows,e.value.cols=e.value.settingsCols,n(e.value.rows,e.value.cols);const t=m(e.value.rows,e.value.cols);e.value.solution=[...t];const s=Array.from({length:e.value.rows},()=>Array(e.value.cols).fill(0));for(const c of t)s[c.y][c.x]++;for(let c=0;c<e.value.rows;c++)for(let d=0;d<e.value.cols;d++){const $=s[c][d],b=e.value.grid[c][d];b.visits=$,$>2?(b.required=1/0,b.remaining=1/0):(b.required=$,b.remaining=$)}const a=t[0];V(a.x,a.y),e.value.player.x=a.x,e.value.player.y=a.y,e.value.moves=0,e.value.showSolution=!1}function m(t,s,a=.8){const c=t*s,d=Math.max(1,Math.floor(c*a)),$=Math.floor(Math.random()*s),b=Math.floor(Math.random()*t),q=Array.from({length:t},()=>Array(s).fill(!1)),M=[{x:$,y:b}];q[b][$]=!0;let F=1,B=0;for(;F<d&&B<5e4;){const j=M[M.length-1],C=w(g(j.x,j.y,s,t));let x=C.find(I=>!q[I.y][I.x]);x||(x=C[Math.floor(Math.random()*C.length)]),M.push(x),q[x.y][x.x]||(q[x.y][x.x]=!0),F++,B++}const Q=Math.floor(Math.random()*(d/3));for(let j=0;j<Q;j++){const C=M[M.length-1],x=g(C.x,C.y,s,t),I=x[Math.floor(Math.random()*x.length)];M.push(I)}return M}function g(t,s,a,c){const d=[];return t>0&&d.push({x:t-1,y:s}),t<a-1&&d.push({x:t+1,y:s}),s>0&&d.push({x:t,y:s-1}),s<c-1&&d.push({x:t,y:s+1}),d}function w(t){for(let s=t.length-1;s>0;s--){const a=Math.floor(Math.random()*(s+1));[t[s],t[a]]=[t[a],t[s]]}return t}function P(){return z.value===0}function L(){e.value.winStreak++,l()}function O(){e.value.winStreak=0,l()}function N(t){const s=e.value.player.x+(t==="left"?-1:t==="right"?1:0),a=e.value.player.y+(t==="up"?-1:t==="down"?1:0);if(t==="left"?e.value.player.facing="left":t==="right"&&(e.value.player.facing="right"),s<0||a<0||s>=e.value.cols||a>=e.value.rows)return;const c=e.value.grid[a][s];Number.isFinite(c.remaining)&&c.remaining<=0||(e.value.player.state="run",e.value.player.x=s,e.value.player.y=a,e.value.moves++,V(s,a),e.value.player.runTimer&&(clearTimeout(e.value.player.runTimer),e.value.player.runTimer=null),e.value.player.runTimer=window.setTimeout(()=>{e.value.player.state="idle",e.value.player.runTimer=null,P()&&L()},_.moveDurationMs))}function V(t,s){const a=e.value.grid[s][t];Number.isFinite(a.remaining)&&a.remaining>0&&a.remaining--}function W(){if(e.value.solution.length){const t=e.value.solution[0];e.value.player.x=t.x,e.value.player.y=t.y}else e.value.player.x=0,e.value.player.y=0;e.value.moves=0;for(const t of r.value)t.remaining=Number.isFinite(t.required)?t.required:1/0;V(e.value.player.x,e.value.player.y),e.value.player.runTimer&&(clearTimeout(e.value.player.runTimer),e.value.player.runTimer=null),e.value.player.state="idle"}const z=h(()=>{let t=0;for(const s of r.value)Number.isFinite(s.required)&&s.remaining>0&&t++;return t});function K(t){return Number.isFinite(t.required)?String(t.remaining):""}function H(t){t.key==="ArrowUp"&&N("up"),t.key==="ArrowDown"&&N("down"),t.key==="ArrowLeft"&&N("left"),t.key==="ArrowRight"&&N("right")}function J(){e.value.showSolution=!e.value.showSolution}return{state:e,startNewGame:O,onKey:H,resetLevel:W,flatCells:r,remainingNeeded:z,cellLabel:K,move:N,toggleShowSolution:J}}),ce={key:0},_e=S({__name:"settings",setup(_){const e=k(),r=h(()=>e.state.solution.map(n=>`(${n.x},${n.y})`).join(" → "));return(n,l)=>{const m=E,g=se;return p(),v("div",{class:u(n.$style.GameSettings)},[i("div",{class:u(n.$style.text)},[i("div",null,[l[2]||(l[2]=y("Remaining required cells: ",-1)),i("strong",null,T(o(e).remainingNeeded),1)]),i("div",null,[l[3]||(l[3]=y("Moves made: ",-1)),i("strong",null,T(o(e).state.moves),1)]),i("div",null,[l[4]||(l[4]=y("Win streak: ",-1)),i("strong",null,T(o(e).state.winStreak),1)])],2),i("div",{class:u(n.$style.btns)},[f(m,{"full-width":"",onClick:o(e).startNewGame},{default:A(()=>[...l[5]||(l[5]=[y(" New ",-1)])]),_:1},8,["onClick"]),f(m,{"full-width":"",onClick:o(e).resetLevel},{default:A(()=>[...l[6]||(l[6]=[y(" Again ",-1)])]),_:1},8,["onClick"])],2),f(g,{modelValue:o(e).state.settingsRows,"onUpdate:modelValue":l[0]||(l[0]=w=>o(e).state.settingsRows=w),label:"Rows",min:3,max:16},null,8,["modelValue"]),f(g,{modelValue:o(e).state.settingsCols,"onUpdate:modelValue":l[1]||(l[1]=w=>o(e).state.settingsCols=w),label:"Cols",min:3,max:16},null,8,["modelValue"]),o(e).state.showSolution&&o(r)?(p(),v("div",ce,[i("div",{class:u(n.$style.text)}," Solution walk (preview) ",2),i("div",{class:u(n.$style.text)},T(o(r)),3)])):U("",!0)],2)}}}),me="_GameSettings_1xpb4_9",de="_btns_1xpb4_15",ye="_text_1xpb4_21",fe={GameSettings:me,btns:de,text:ye},pe={$style:fe},ve=G(_e,[["__cssModules",pe]]),ge=S({__name:"controls",setup(_){const e=k();return(r,n)=>{const l=E;return p(),v("div",{class:u(r.$style.GameControls)},[f(l,{onClick:n[0]||(n[0]=m=>o(e).move("up"))},{default:A(()=>[...n[4]||(n[4]=[y(" ▲ ",-1)])]),_:1}),f(l,{onClick:n[1]||(n[1]=m=>o(e).move("left"))},{default:A(()=>[...n[5]||(n[5]=[y(" ◀ ",-1)])]),_:1}),f(l,{onClick:n[2]||(n[2]=m=>o(e).move("right"))},{default:A(()=>[...n[6]||(n[6]=[y(" ▶ ",-1)])]),_:1}),f(l,{onClick:n[3]||(n[3]=m=>o(e).move("down"))},{default:A(()=>[...n[7]||(n[7]=[y(" ▼ ",-1)])]),_:1})],2)}}}),$e="_GameControls_1bula_9",we={GameControls:$e},xe={$style:we},he=G(ge,[["__cssModules",xe]]),Ge={key:0},be=S({__name:"aside",setup(_){const e=k(),r=h(()=>e.state.solution.map(n=>`(${n.x},${n.y})`).join(" → "));return(n,l)=>{const m=ue,g=ve,w=he;return p(),v("div",{class:u(n.$style.GameAside)},[f(m),f(g),f(w),i("div",{class:u(n.$style.text)},[...l[0]||(l[0]=[y(" How generation works (guaranteed solvable): ",-1),i("br",null,null,-1),y(" 1. A random walk is generated that covers at least 80% of the grid cells. ",-1),i("br",null,null,-1),y(' 2. The cells visited by the walk are flipped to "on". ',-1),i("br",null,null,-1),y(" 3. The player starts at the beginning of the walk. ",-1),i("br",null,null,-1),y(' 4. The goal is to step on all "on" cells to turn them "off". ',-1),i("br",null,null,-1),y(" 5. The solution walk is provided as a hint. ",-1),i("br",null,null,-1)])],2),o(e).state.showSolution&&o(r)?(p(),v("div",Ge,[i("div",{class:u(n.$style.text)}," Solution walk (preview) ",2),i("div",{class:u(n.$style.text)},T(o(r)),3)])):U("",!0)],2)}}}),Me="_GameAside_7rcje_9",Se="_text_7rcje_16",ke={GameAside:Me,text:Se},Ce={$style:ke},Te=G(be,[["__cssModules",Ce]]),Ae=S({__name:"cell",props:{cell:{}},setup(_){const e=D(),r=k(),n=_,l=h(()=>Number.isFinite(n.cell.required)?n.cell.remaining===2||n.cell.remaining===1&&r.state.player.x===n.cell.x&&r.state.player.y===n.cell.y?"double":n.cell.remaining===1||n.cell.remaining===0&&r.state.player.x===n.cell.x&&r.state.player.y===n.cell.y?"single":"satisfied":"inf"),m=h(()=>({[e["_"+l.value]]:!0})),g=h(()=>r.cellLabel(n.cell));return(w,P)=>(p(),v("div",{class:u([o(e).GameCell,o(m)])},[i("div",{class:u(o(e).inner)},T(o(g)),3)],2))}}),Ne="_GameCell_d833z_9",je="__single_d833z_19",Pe="__double_d833z_24",qe="__inf_d833z_29",Ie="__satisfied_d833z_34",Le="_inner_d833z_41",Ve={GameCell:Ne,_single:je,_double:Pe,_inf:qe,_satisfied:Ie,inner:Le},ze={$style:Ve},Fe=G(Ae,[["__cssModules",ze]]),Be=S({__name:"player",setup(_){const e=D(),r=k(),n=h(()=>({[e["_"+r.state.player.state]]:!0,[e["_"+r.state.player.facing]]:!0}));return(l,m)=>(p(),v("div",{class:u([o(e).GamePlayer,o(n)])},null,2))}}),Re="_GamePlayer_ic2jp_9",Ue="__idle_ic2jp_21",De="_idle_ic2jp_1",Ee="__run_ic2jp_26",Oe="_run_ic2jp_1",We="__left_ic2jp_31",Ke="__right_ic2jp_34",He={GamePlayer:Re,_idle:Ue,idle:De,_run:Ee,run:Oe,_left:We,_right:Ke},Je={$style:He},Qe=G(Be,[["__cssModules",Je]]),Xe=S({__name:"grid",setup(_){const e=k(),r=h(()=>({gridTemplateColumns:`repeat(${e.state.cols}, 5.2rem)`})),n=h(()=>({top:e.state.player.y*5.2-3.2+"rem",left:e.state.player.x*5.2-1.4+"rem"}));return(l,m)=>{const g=Fe,w=Qe;return p(),v("div",{class:u(l.$style.GameGrid),style:R(o(r))},[(p(!0),v(Z,null,ee(o(e).flatCells,(P,L)=>(p(),te(g,{key:"cell-"+L,cell:P},null,8,["cell"]))),128)),f(w,{class:u(l.$style.player),style:R(o(n))},null,8,["class","style"])],6)}}}),Ye="_GameGrid_8r5jd_9",Ze="_player_8r5jd_14",et={GameGrid:Ye,player:Ze},tt={$style:et},nt=G(Xe,[["__cssModules",tt]]),st=S({__name:"TheGame",setup(_){const e=k();return ne(()=>{e.startNewGame(),window.addEventListener("keydown",e.onKey)}),(r,n)=>{const l=Te,m=nt;return p(),v("div",{class:u(r.$style.TheGame)},[f(l),f(m,{class:u(r.$style.grid)},null,8,["class"])],2)}}}),lt="_TheGame_1xo64_9",ot="_grid_1xo64_16",rt={TheGame:lt,grid:ot},at={$style:rt},it=G(st,[["__cssModules",at]]),ut="_IndexPage_6qbow_9",ct={IndexPage:ut},_t={};function mt(_,e){const r=it;return p(),v("div",{class:u([_.$style.IndexPage,"container"])},[f(r)],2)}const dt={$style:ct},pt=G(_t,[["render",mt],["__cssModules",dt]]);export{pt as default};
